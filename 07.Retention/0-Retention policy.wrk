{"data":[{"id":"1689062366028419","contents":"데이터 자동 삭제\n======\n개요\n------\n\nTAG 테이블마다 데이터 보존 기간을 지정하여 지정된 기간을 초과한 데이터를 자동으로 삭제 가능함 \n\n보존 기간 및 삭제 주기를 지정한 Retention Policy를 생성하고, ALTER 구문을 통해 테이블에 적용/해제할 수 있음\n\nRetention Policy 생성\n------\n보존 기간 및 삭제 주기를 지정하여 RETENTION POLICY를 생성함\n\n보존 기간은 월(MONTH), 일(DAY) 단위로 지정할 수 있으며, 삭제 주기는 일(DAY), 시간(HOUR) 단위로 지정 가능함\n\nPOLICY 정보는 M$RETENTION 테이블 조회하여 확인할 수 있음\n\nSyntax\n```sql\nCREATE RETENTION 'policy name' DURATION 'duration' MONTH|DAY INTERVAL 'interval' DAY|HOUR\n```\n* policy name : 생성할 policy 이름\n* duration : 삭제할 데이터의 보존 기간(시스템 시간 기준)\n* interval : 보존 기간 확인 주기\n\n예시\n\n1일 이상 지난 데이터를 삭제하고, 갱신 주기를 1시간으로 함\n","height":237,"lineHeight":19,"minimal":true,"type":"mrk","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"],["shell","Shell"]],"result":"","status":true},{"id":"1692694238727935","type":"sql","contents":"CREATE RETENTION policy_1d_1h DURATION 1 DAY INTERVAL 1 HOUR;","status":true,"height":46,"lang":[["SQL","SQL"],["markdown","Markdown"],["javascript","TQL"]],"minimal":false,"result":""},{"id":"1692694258307116","contents":"1개월이 지난 데이터를 삭제하고 새로 고침 간격은 3일로 설정","height":50,"lineHeight":19,"minimal":true,"type":"mrk","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"],["shell","Shell"]],"result":"","status":true},{"id":"1692694264148577","type":"sql","contents":"CREATE RETENTION policy_1m_3d DURATION 1 MONTH INTERVAL 3 DAY;","status":true,"height":45,"lang":[["SQL","SQL"],["markdown","Markdown"],["javascript","TQL"]],"minimal":false,"result":""},{"id":"1692694340370313","type":"sql","contents":"SELECT * FROM M$RETENTION;","status":true,"height":41,"lang":[["SQL","SQL"],["markdown","Markdown"],["javascript","TQL"]],"minimal":false,"result":""},{"id":"1692694380748540","contents":"Retention Policy 적용\n------\n사전에 생성된 RETENTION POLICY를 테이블에 적용 \n\n적용 이후에는 삭제 주기마다 보존 기간을 확인하여 삭제\n \nRETENTION POLICY가 적용된 테이블 정보는 V$RETENTION_JOB 테이블을 조회하여 확인 가능함\n\nSyntax\n```sql\nALTER TABLE 'table name' ADD RETENTION 'policy name'\n```\n * table name : 적용할 table 이름\n * policy name : 적용할 policy 이름\n\n예시","height":200,"lineHeight":19,"minimal":true,"type":"mrk","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"],["shell","Shell"]],"result":"","status":true},{"id":"1692694422435115","contents":"DROP TABLE ret_tag CASCADE;\r\nCREATE tag TABLE ret_tag (name varchar(20) primary key, time datetime basetime, value double summarized) WITH rollup(min) TAG_PARTITION_COUNT=1;","height":67,"lineHeight":19,"minimal":false,"type":"sql","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"]],"result":"","status":true,"brief":true},{"id":"1692694445980160","contents":"ALTER TABLE ret_tag ADD RETENTION policy_1d_1h;","height":45,"lineHeight":19,"minimal":false,"type":"sql","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"],["shell","Shell"]],"result":"","status":true,"brief":true},{"id":"1692694472931400","type":"sql","contents":"SELECT * FROM V$RETENTION_JOB;","status":true,"height":41,"lang":[["SQL","SQL"],["markdown","Markdown"],["javascript","TQL"]],"minimal":false,"result":""},{"id":"1720680521090987","contents":"데이터 입력을 위한 TQL","height":78,"lineHeight":19,"minimal":true,"type":"mrk","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"],["shell","Shell"]],"result":"","status":true},{"id":"1720680545726482","contents":"FAKE( arrange(1, 150000, 1))\r\nMAPVALUE(1, sin((2*PI*value(0)/100)))\r\nMAPVALUE(0, timeAdd(\"now-2d\", strSprintf(\"+%.fs\", value(0))))\r\nPUSHVALUE(0, \"chart-line\")\r\nAPPEND(table(\"ret_tag\"))","height":111,"lineHeight":19,"minimal":false,"type":"tql","tqlType":"text","lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"]],"result":"","status":true},{"id":"1720681811893187","contents":"데이터 로딩 후 건수 확인","height":51,"lineHeight":19,"minimal":true,"type":"mrk","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"],["shell","Shell"]],"result":"","status":true},{"id":"1720681641072873","contents":"SELECT COUNT(*) FROM ret_tag;","height":53,"lineHeight":19,"minimal":false,"type":"sql","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"]],"result":"","status":true,"brief":true},{"id":"1720680634102371","contents":"데이터가 삭제됨을 확인 ( 대략 한시간 이후에 수행 )","height":62,"lineHeight":19,"minimal":true,"type":"mrk","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"],["shell","Shell"]],"result":"","status":true},{"id":"172068070986164","contents":"SELECT * FROM V$RETENTION_JOB;\r\n\r\nSELECT COUNT(*) FROM RET_TAG;","height":74,"lineHeight":19,"minimal":false,"type":"sql","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"]],"result":"","status":true,"brief":true},{"id":"1692694518003290","contents":"Release Retention 해제\n------\n테이블에 적용된 RETENTION POLICY를 해제\n\n해제 이후에는 데이터가 삭제되지 않고 영구 보존됨\n\nSyntax\n```sql\nALTER TABLE 'table_name' DROP RETENTION;\n```\n\n예시","height":200,"lineHeight":19,"minimal":true,"type":"mrk","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"],["shell","Shell"]],"result":"","status":true},{"id":"1692694571587357","type":"sql","contents":"ALTER TABLE tag DROP RETENTION;","status":true,"height":39,"lang":[["SQL","SQL"],["markdown","Markdown"],["javascript","TQL"]],"minimal":false,"result":""},{"id":"16926945861311","contents":"Retention Policy 삭제\n------\n해당 RETENTION POLICY가 적용 중인 테이블이 존재하면 삭제 불가\n\n적용 중인 테이블의 RETENTION을 해제하고 삭제해야 함\n\nSyntax\n```sql\nDROP RETENTION 'policy_name'\n```\n예시","height":200,"lineHeight":19,"minimal":true,"type":"mrk","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"],["shell","Shell"]],"result":"","status":true},{"id":"1692694640555437","contents":"ALTER TABLE tag ADD RETENTION policy_1d_1h;","height":37,"lineHeight":19,"minimal":false,"type":"sql","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"]],"result":"","status":true,"brief":true},{"id":"1692694667235902","contents":"--오류 발생 예시","height":37,"lineHeight":19,"minimal":true,"type":"mrk","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"],["shell","Shell"]],"result":"","status":true},{"id":"1692694678947330","contents":"DROP RETENTION policy_1d_1h;","height":67,"lineHeight":19,"minimal":false,"type":"sql","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"]],"result":"","status":true,"brief":true},{"id":"1692694694931134","contents":"ALTER TABLE tag DROP RETENTION;","height":73,"lineHeight":19,"minimal":false,"type":"sql","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"]],"result":"","status":true,"brief":true},{"id":"1692694729970872","contents":"-- 성공 예시","height":42,"lineHeight":19,"minimal":true,"type":"mrk","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"],["shell","Shell"]],"result":"","status":true},{"id":"1692694751443594","contents":"DROP RETENTION policy_1d_1h;","height":66,"lineHeight":19,"minimal":false,"type":"sql","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"]],"result":"","status":true,"brief":true},{"id":"172196063031448","contents":"-- Retention Policy 변경","height":65,"lineHeight":19,"minimal":true,"type":"mrk","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"],["shell","Shell"]],"result":"","status":true},{"id":"1721960667055171","contents":"ALTER TABLE tag ADD RETENTION policy_1m_3d;","height":60,"lineHeight":19,"minimal":false,"type":"sql","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"]],"result":"","status":true,"brief":true},{"id":"1721960750181556","contents":"SELECT * FROM V$RETENTION_JOB;","height":63,"lineHeight":19,"minimal":false,"type":"sql","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"]],"result":"","status":true,"brief":true},{"id":"1692694792523687","contents":"Fixed Table\n------\nRETENTION_POLICY 정보를 저장하고 있는 M$RETENTION 테이블","height":82,"lineHeight":19,"minimal":true,"type":"mrk","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"],["shell","Shell"]],"result":"","status":true},{"id":"1724044563535238","contents":"desc m$retention;","height":64,"lineHeight":19,"minimal":false,"type":"shell","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"],["shell","Shell"]],"result":"","status":true},{"id":"172403768111232","contents":"desc m$retention;","height":47,"lineHeight":19,"minimal":true,"type":"shell","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"],["shell","Shell"]],"result":"","status":true},{"id":"1724043859223351","contents":"|   Column Name  |  Description           |\r\n|:--------------:|:----------------------:|\r\n| USER_ID        | 사용자 아이디          |\r\n| POLICY_NAME    | policy 명              |\r\n| DURATION       | 만료 일자(초)          |\r\n| INTERVAL       | 수행 주기(초)          |","height":138,"lineHeight":19,"minimal":true,"type":"mrk","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"],["shell","Shell"]],"result":"","status":true},{"id":"1724037760712836","contents":"V$RETENTION_JOB 테이블에는 RETENTION_POLICY가 적용된 TAG 테이블에 대한 정보가 저장됨","height":59,"lineHeight":19,"minimal":true,"type":"mrk","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"],["shell","Shell"]],"result":"","status":true},{"id":"1724037797499643","contents":"desc v$retention_job;","height":65,"lineHeight":19,"minimal":false,"type":"shell","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"],["shell","Shell"]],"result":"","status":true},{"id":"1724037886204625","contents":"|   Column Name     |  Description           |\r\n|:-----------------:|:----------------------:|\r\n| USER_NAME         | 사용자 아이디          |\r\n| TABLE_NAME        | policy 명              |\r\n| POLICY_NAME       | 만료 일자(초)          |\r\n| STATE             | 수행 주기(초)          |\r\n| LAST_DELETED_TIME | 마지막 삭제 시간       |","height":165,"lineHeight":19,"minimal":true,"type":"mrk","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"],["shell","Shell"]],"result":"","status":true}]}