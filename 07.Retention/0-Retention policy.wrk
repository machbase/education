{"data":[{"id":"1689062366028419","type":"mrk","contents":"Retention Policy \n======\nOverview\n------\nYou can specify a data retention period for each TAG table, allowing you to automatically delete data that has exceeded its designated duration. By creating a Retention Policy that specifies the retention period and deletion interval, you can apply and remove it to/from TAG tables using the ALTER statement.\n\nCreating a Retention Policy\n------\nCreate a Retention Policy by setting the retention period and deletion interval. The retention period can be specified in months and days, while the deletion interval can be specified in days and hours. Policy information can be verified by querying the M$RETENTION table.\n\nSyntax\n```sql\nCREATE RETENTION 'policy name' DURATION 'duration' MONTH|DAY INTERVAL 'interval' DAY|HOUR\n```\n* policy name \n* duration : Expiration period of data to be deleted (based on the system).\n* interval : User-defined refresh interval.\n\nExample of use.\nDelete data older than 1 day and set the refresh interval to 1 hour.\n","result":"","status":true,"height":200,"lang":[["markdown","Markdown"],["SQL","SQL"],["javascript","TQL"]],"minimal":true},{"id":"1692694238727935","type":"sql","contents":"CREATE RETENTION policy_1d_1h DURATION 1 DAY INTERVAL 1 HOUR;","status":true,"height":46,"lang":[["SQL","SQL"],["markdown","Markdown"],["javascript","TQL"]],"minimal":false,"result":""},{"id":"1692694258307116","type":"mrk","contents":"Delete data older than 1 month and set the refresh interval to 3 days.","status":true,"height":200,"lang":[["markdown","Markdown"],["SQL","SQL"],["javascript","TQL"]],"minimal":true,"result":""},{"id":"1692694264148577","type":"sql","contents":"CREATE RETENTION policy_1m_3d DURATION 1 MONTH INTERVAL 3 DAY;","status":true,"height":45,"lang":[["SQL","SQL"],["markdown","Markdown"],["javascript","TQL"]],"minimal":false,"result":""},{"id":"1692694340370313","type":"sql","contents":"SELECT * FROM M$RETENTION;","status":true,"height":41,"lang":[["SQL","SQL"],["markdown","Markdown"],["javascript","TQL"]],"minimal":false,"result":""},{"id":"1692694380748540","type":"mrk","contents":"Applying Retention Policy.\n------\nApply the pre-created RETENTION POLICY to the table. After application, the retention period is checked and data is deleted at each deletion interval. Information about tables with applied RETENTION POLICY can be verified by querying the V$RETENTION_JOB table.\n\nSyntax\n```sql\nALTER TABLE 'table name' ADD RETENTION 'policy name'\n```\n * table name : tag table name\n * policy name : Policy name to apply.\n\nExample of use.","status":true,"height":200,"lang":[["markdown","Markdown"],["SQL","SQL"],["javascript","TQL"]],"minimal":true,"result":""},{"id":"1692694422435115","contents":"DROP TABLE ret_tag CASCADE;\r\nCREATE tag TABLE ret_tag (name varchar(20) primary key, time datetime basetime, value double summarized) WITH rollup(min) TAG_PARTITION_COUNT=1;","height":67,"lineHeight":19,"minimal":false,"type":"sql","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"]],"result":"","status":true,"brief":true},{"id":"1692694445980160","type":"sql","contents":"ALTER TABLE tag ADD RETENTION policy_1d_1h;","status":true,"height":45,"lang":[["SQL","SQL"],["markdown","Markdown"],["javascript","TQL"]],"minimal":false,"result":""},{"id":"1692694472931400","type":"sql","contents":"SELECT * FROM V$RETENTION_JOB;","status":true,"height":41,"lang":[["SQL","SQL"],["markdown","Markdown"],["javascript","TQL"]],"minimal":false,"result":""},{"id":"1720680521090987","contents":"TQL for DATA LOAD.","height":200,"lineHeight":19,"minimal":true,"type":"mrk","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"]],"result":"","status":true},{"id":"1720680545726482","contents":"FAKE( arrange(1, 150000, 1))\r\nMAPVALUE(1, sin((2*PI*value(0)/100)))\r\nMAPVALUE(0, timeAdd(\"now-2d\", strSprintf(\"+%.fs\", value(0))))\r\nPUSHVALUE(0, \"chart-line\")\r\nAPPEND(table(\"ret_tag\"))","height":111,"lineHeight":19,"minimal":false,"type":"tql","tqlType":"text","lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"]],"result":"","status":true},{"id":"1720681811893187","contents":"Check count after Loading.","height":51,"lineHeight":19,"minimal":true,"type":"mrk","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"]],"result":"","status":true},{"id":"1720681641072873","contents":"SELECT COUNT(*) FROM ret_tag;","height":53,"lineHeight":19,"minimal":false,"type":"sql","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"]],"result":"","status":true,"brief":true},{"id":"1720680634102371","contents":"Check for DATA deletion.","height":200,"lineHeight":19,"minimal":true,"type":"mrk","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"]],"result":"","status":true},{"id":"172068070986164","contents":"SELECT * FROM V$RETENTION_JOB;\r\n\r\nSELECT COUNT(*) FROM RET_TAG;","height":74,"lineHeight":19,"minimal":false,"type":"sql","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"]],"result":"","status":true,"brief":true},{"id":"1692694518003290","contents":"Release Retention Policy.\n------\nRelease the applied RETENTION POLICY from the table.\n\nAfter release, the data will not be deleted and will be preserved permanently.\n\nSyntax\n```sql\nALTER TABLE 'table_name' DROP RETENTION;\n```\n\nExample of use.","height":200,"lineHeight":19,"minimal":true,"type":"mrk","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"]],"result":"","status":true},{"id":"1692694571587357","type":"sql","contents":"ALTER TABLE tag DROP RETENTION;","status":true,"height":39,"lang":[["SQL","SQL"],["markdown","Markdown"],["javascript","TQL"]],"minimal":false,"result":""},{"id":"16926945861311","type":"mrk","contents":"Delete Retention Policy\n------\nIf there are tables currently subject to the applied RETENTION POLICY, it cannot be deleted.\n\nYou need to release and remove the RETENTION from the tables that have it applied before deletion.\n\nSyntax\n```sql\nDROP RETENTION 'policy_name'\n```\nExample of use","status":true,"height":200,"lang":[["markdown","Markdown"],["SQL","SQL"],["javascript","TQL"]],"minimal":true,"result":""},{"id":"1692694640555437","contents":"ALTER TABLE tag ADD RETENTION policy_1d_1h;","height":37,"lineHeight":19,"minimal":false,"type":"sql","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"]],"result":"","status":true,"brief":true},{"id":"1692694667235902","contents":"--ERROR","height":37,"lineHeight":19,"minimal":true,"type":"mrk","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"]],"result":"","status":true},{"id":"1692694678947330","contents":"DROP RETENTION policy_1d_1h;","height":67,"lineHeight":19,"minimal":false,"type":"sql","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"]],"result":"","status":true,"brief":true},{"id":"1692694694931134","contents":"ALTER TABLE tag DROP RETENTION;","height":73,"lineHeight":19,"minimal":false,"type":"sql","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"]],"result":"","status":true,"brief":true},{"id":"1692694729970872","contents":"-- SUCCESS","height":42,"lineHeight":19,"minimal":true,"type":"mrk","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"]],"result":"","status":true},{"id":"1692694751443594","contents":"DROP RETENTION policy_1d_1h;","height":88,"lineHeight":19,"minimal":false,"type":"sql","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"]],"result":"","status":true,"brief":true},{"id":"1692694792523687","contents":"Fixed Table\n------\nThe M$RETENTION table stores RETENTION_POLICY information.\n```sql\nmachbase-neo» desc m$retention;\n┌────────┬─────────────┬─────────┬────────┐\n│ ROWNUM │ NAME        │ TYPE    │ LENGTH │\n├────────┼─────────────┼─────────┼────────┤\n│      1 │ USER_ID     │ int32   │      4 │\n│      2 │ POLICY_NAME │ varchar │     40 │\n│      3 │ DURATION    │ int64   │      8 │\n│      4 │ INTERVAL    │ int64   │      8 │\n└────────┴─────────────┴─────────┴────────┘\n```\n|   Column Name  |  Description   |\n|:--------------:|:----------------------:|\n| USER_ID        | user ID                |\n| POLICY_NAME    | policy name            |\n| DURATION       | expiration period(sec) |\n| INTERVAL       | refresh interval(sec)  |\n\nThe V$RETENTION_JOB table stores information about TAG tables with applied RETENTION_POLICY.\n\n```sql\nmachbase-neo» desc v$retention_job;\n[ COLUMN ]                             \n----------------------------------------------------------------------------------------------------\nNAME                                                        NULL?    TYPE                LENGTH       \n----------------------------------------------------------------------------------------------------\nUSER_NAME                                                            varchar             100                \nTABLE_NAME                                                           varchar             100                \nPOLICY_NAME                                                          varchar             100                \nSTATE                                                                varchar             100                \nLAST_DELETED_TIME                                                    datetime            31\n```\n|   Column Name  |  Description   |\n|:-----------------:|:----------------------:|\n| USER_NAME         | user ID                |\n| TABLE_NAME        | policy name            |\n| POLICY_NAME       | expiration period(sec) |\n| STATE             | refresh interval(sec) |\n| LAST_DELETED_TIME | policy name            |\n","height":200,"lineHeight":19,"minimal":true,"type":"mrk","tqlType":null,"lang":[["markdown","Markdown"],["SQL","SQL"],["go","TQL"]],"result":"","status":true}]}